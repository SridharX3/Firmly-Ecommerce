import{w as d}from"./BkELfgbM.js";import{a as s,A as i}from"./B7eymPUq.js";const l="https://order-worker.sridhar-89c.workers.dev",n=()=>{if(typeof localStorage>"u")return null;try{const r=localStorage.getItem("checkout_state");return r?{...JSON.parse(r),loading:!1,error:null}:null}catch{return null}},a=d(n()||{loading:!1,error:null,step:"shipping",summary:null,checkoutId:null,savedShippingAddresses:[],savedBillingAddresses:[]});a.subscribe(r=>{typeof localStorage<"u"&&localStorage.setItem("checkout_state",JSON.stringify(r))});async function u(r){a.update(e=>({...e,loading:!0,error:null}));try{const e=await s(`${l}/checkout/shipping`,{method:"POST",credentials:"include",body:JSON.stringify({shipping_address:r})});if(e.error)throw new Error(e.error||"Failed to save shipping address");return a.update(t=>({...t,loading:!1,step:"billing_address"})),e}catch(e){throw a.update(t=>({...t,loading:!1,error:e.message})),e}}async function p(){a.update(r=>({...r,loading:!0,error:null}));try{const[r,e]=await Promise.all([s(`${i}/user/shipping-address`,{credentials:"include"}),s(`${i}/user/billing-address`,{credentials:"include"})]);a.update(t=>({...t,loading:!1,savedShippingAddresses:r.addresses||[],savedBillingAddresses:e.addresses||[]}))}catch(r){console.error("Failed to load saved addresses:",r),a.update(e=>({...e,loading:!1}))}}async function g(r){a.update(e=>({...e,loading:!0,error:null}));try{const e=await s(`${l}/checkout/billing`,{method:"POST",credentials:"include",body:JSON.stringify({billing_address:r})});if(e.error)throw new Error(e.error||"Failed to save billing address");return a.update(t=>({...t,loading:!1,step:"delivery"})),e}catch(e){throw a.update(t=>({...t,loading:!1,error:e.message})),e}}async function h(r){a.update(e=>({...e,loading:!0,error:null}));try{const e=await s(`${l}/checkout/delivery`,{method:"POST",credentials:"include",body:JSON.stringify({delivery_type:r})});if(e.error)throw new Error(e.error||"Failed to update delivery method");return a.update(t=>({...t,loading:!1,summary:e.summary,step:"payment"})),e}catch(e){throw a.update(t=>({...t,loading:!1,error:e.message})),e}}async function f(){try{await s(`${l}/checkout/cancel`,{method:"POST",credentials:"include"}),a.set({loading:!1,error:null,step:"shipping",summary:null,checkoutId:null})}catch(r){console.error("Failed to cancel checkout:",r)}}async function y(){a.update(r=>({...r,loading:!0,error:null}));try{const r=await s(`${l}/payments/paypal/create`,{method:"POST",credentials:"include"});if(r.error)throw new Error(r.error||"Payment initialization failed");return a.update(e=>({...e,loading:!1})),r}catch(r){throw a.update(e=>({...e,loading:!1,error:r.message})),r}}export{g as a,h as b,a as c,y as d,f as e,p as l,u as s};
